{"ast":null,"code":"/* globals AbortController */\n'use strict';\n\nconst {\n  extractBody,\n  mixinBody,\n  cloneBody\n} = require('./body');\n\nconst {\n  Headers,\n  fill: fillHeaders,\n  HeadersList\n} = require('./headers');\n\nconst util = require('../core/util');\n\nconst {\n  isValidHTTPToken,\n  EnvironmentSettingsObject,\n  sameOrigin,\n  toUSVString\n} = require('./util');\n\nconst {\n  forbiddenMethods,\n  corsSafeListedMethods,\n  referrerPolicy,\n  requestRedirect,\n  requestMode,\n  requestCredentials,\n  requestCache\n} = require('./constants');\n\nconst {\n  kEnumerableProperty\n} = util;\n\nconst {\n  kHeaders,\n  kSignal,\n  kState,\n  kGuard,\n  kRealm\n} = require('./symbols');\n\nconst {\n  kHeadersList\n} = require('../core/symbols');\n\nconst assert = require('assert');\n\nlet TransformStream;\nconst kInit = Symbol('init');\nconst requestFinalizer = new FinalizationRegistry(_ref => {\n  let {\n    signal,\n    abort\n  } = _ref;\n  signal.removeEventListener('abort', abort);\n}); // https://fetch.spec.whatwg.org/#request-class\n\nclass Request {\n  // https://fetch.spec.whatwg.org/#dom-request\n  constructor() {\n    if ((arguments.length <= 0 ? undefined : arguments[0]) === kInit) {\n      return;\n    }\n\n    if (arguments.length < 1) {\n      throw new TypeError(`Failed to construct 'Request': 1 argument required, but only ${arguments.length} present.`);\n    }\n\n    if (arguments.length >= 1 && typeof (arguments.length <= 1 ? undefined : arguments[1]) !== 'object' && (arguments.length <= 1 ? undefined : arguments[1]) !== undefined) {\n      throw new TypeError(\"Failed to construct 'Request': cannot convert to dictionary.\");\n    }\n\n    const input = (arguments.length <= 0 ? undefined : arguments[0]) instanceof Request ? arguments.length <= 0 ? undefined : arguments[0] : toUSVString(arguments.length <= 0 ? undefined : arguments[0]);\n    const init = arguments.length >= 1 ? (arguments.length <= 1 ? undefined : arguments[1]) ?? {} : {}; // TODO\n\n    this[kRealm] = {\n      settingsObject: {}\n    }; // 1. Let request be null.\n\n    let request = null; // 2. Let fallbackMode be null.\n\n    let fallbackMode = null; // 3. Let baseURL be this’s relevant settings object’s API base URL.\n\n    const baseUrl = this[kRealm].settingsObject.baseUrl; // 4. Let signal be null.\n\n    let signal = null; // 5. If input is a string, then:\n\n    if (typeof input === 'string') {\n      // 1. Let parsedURL be the result of parsing input with baseURL.\n      // 2. If parsedURL is failure, then throw a TypeError.\n      let parsedURL;\n\n      try {\n        parsedURL = new URL(input, baseUrl);\n      } catch (err) {\n        const error = new TypeError('Failed to parse URL from ' + input);\n        error.cause = err;\n        throw error;\n      } // 3. If parsedURL includes credentials, then throw a TypeError.\n\n\n      if (parsedURL.username || parsedURL.password) {\n        throw new TypeError('Request cannot be constructed from a URL that includes credentials: ' + input);\n      } // 4. Set request to a new request whose URL is parsedURL.\n\n\n      request = makeRequest({\n        urlList: [parsedURL]\n      }); // 5. Set fallbackMode to \"cors\".\n\n      fallbackMode = 'cors';\n    } else {\n      // 6. Otherwise:\n      // 7. Assert: input is a Request object.\n      assert(input instanceof Request); // 8. Set request to input’s request.\n\n      request = input[kState]; // 9. Set signal to input’s signal.\n\n      signal = input[kSignal];\n    } // 7. Let origin be this’s relevant settings object’s origin.\n\n\n    const origin = this[kRealm].settingsObject.origin; // 8. Let window be \"client\".\n\n    let window = 'client'; // 9. If request’s window is an environment settings object and its origin\n    // is same origin with origin, then set window to request’s window.\n\n    if (request.window instanceof EnvironmentSettingsObject && sameOrigin(request.window, origin)) {\n      window = request.window;\n    } // 10. If init[\"window\"] exists and is non-null, then throw a TypeError.\n\n\n    if (init.window !== undefined && init.window != null) {\n      throw new TypeError(`'window' option '${window}' must be null`);\n    } // 11. If init[\"window\"] exists, then set window to \"no-window\".\n\n\n    if (init.window !== undefined) {\n      window = 'no-window';\n    } // 12. Set request to a new request with the following properties:\n\n\n    request = makeRequest({\n      // URL request’s URL.\n      // undici implementation note: this is set as the first item in request's urlList in makeRequest\n      // method request’s method.\n      method: request.method,\n      // header list A copy of request’s header list.\n      // undici implementation note: headersList is cloned in makeRequest\n      headersList: request.headersList,\n      // unsafe-request flag Set.\n      unsafeRequest: request.unsafeRequest,\n      // client This’s relevant settings object.\n      client: request.client,\n      // window window.\n      window,\n      // priority request’s priority.\n      priority: request.priority,\n      // origin request’s origin. The propagation of the origin is only significant for navigation requests\n      // being handled by a service worker. In this scenario a request can have an origin that is different\n      // from the current client.\n      origin: request.origin,\n      // referrer request’s referrer.\n      referrer: request.referrer,\n      // referrer policy request’s referrer policy.\n      referrerPolicy: request.referrerPolicy,\n      // mode request’s mode.\n      mode: request.mode,\n      // credentials mode request’s credentials mode.\n      credentials: request.credentials,\n      // cache mode request’s cache mode.\n      cache: request.cache,\n      // redirect mode request’s redirect mode.\n      redirect: request.redirect,\n      // integrity metadata request’s integrity metadata.\n      integrity: request.integrity,\n      // keepalive request’s keepalive.\n      keepalive: request.keepalive,\n      // reload-navigation flag request’s reload-navigation flag.\n      reloadNavigation: request.reloadNavigation,\n      // history-navigation flag request’s history-navigation flag.\n      historyNavigation: request.historyNavigation,\n      // URL list A clone of request’s URL list.\n      // undici implementation note: urlList is cloned in makeRequest\n      urlList: request.urlList\n    }); // 13. If init is not empty, then:\n\n    if (Object.keys(init).length > 0) {\n      // 1. If request’s mode is \"navigate\", then set it to \"same-origin\".\n      if (request.mode === 'navigate') {\n        request.mode = 'same-origin';\n      } // 2. Unset request’s reload-navigation flag.\n\n\n      request.reloadNavigation = false; // 3. Unset request’s history-navigation flag.\n\n      request.historyNavigation = false; // 4. Set request’s origin to \"client\".\n\n      request.origin = 'client'; // 5. Set request’s referrer to \"client\"\n\n      request.referrer = 'client'; // 6. Set request’s referrer policy to the empty string.\n\n      request.referrerPolicy = ''; // 7. Set request’s URL to request’s current URL.\n\n      request.url = request.urlList[request.urlList.length - 1]; // 8. Set request’s URL list to « request’s URL ».\n\n      request.urlList = [request.url];\n    } // 14. If init[\"referrer\"] exists, then:\n\n\n    if (init.referrer !== undefined) {\n      // 1. Let referrer be init[\"referrer\"].\n      const referrer = init.referrer; // 2. If referrer is the empty string, then set request’s referrer to \"no-referrer\".\n\n      if (referrer === '') {\n        request.referrer = 'no-referrer';\n      } else {\n        // 1. Let parsedReferrer be the result of parsing referrer with\n        // baseURL.\n        // 2. If parsedReferrer is failure, then throw a TypeError.\n        let parsedReferrer;\n\n        try {\n          parsedReferrer = new URL(referrer, baseUrl);\n        } catch (err) {\n          const error = new TypeError(`Referrer \"${referrer}\" is not a valid URL.`);\n          error.cause = err;\n          throw error;\n        } // 3. If one of the following is true\n        // parsedReferrer’s cannot-be-a-base-URL is true, scheme is \"about\",\n        // and path contains a single string \"client\"\n        // parsedReferrer’s origin is not same origin with origin\n        // then set request’s referrer to \"client\".\n        // TODO\n        // 4. Otherwise, set request’s referrer to parsedReferrer.\n\n\n        request.referrer = parsedReferrer;\n      }\n    } // 15. If init[\"referrerPolicy\"] exists, then set request’s referrer policy\n    // to it.\n\n\n    if (init.referrerPolicy !== undefined) {\n      request.referrerPolicy = init.referrerPolicy;\n\n      if (!referrerPolicy.includes(request.referrerPolicy)) {\n        throw new TypeError(`Failed to construct 'Request': The provided value '${request.referrerPolicy}' is not a valid enum value of type ReferrerPolicy.`);\n      }\n    } // 16. Let mode be init[\"mode\"] if it exists, and fallbackMode otherwise.\n\n\n    let mode;\n\n    if (init.mode !== undefined) {\n      mode = init.mode;\n\n      if (!requestMode.includes(mode)) {\n        throw new TypeError(`Failed to construct 'Request': The provided value '${request.mode}' is not a valid enum value of type RequestMode.`);\n      }\n    } else {\n      mode = fallbackMode;\n    } // 17. If mode is \"navigate\", then throw a TypeError.\n\n\n    if (mode === 'navigate') {\n      throw new TypeError();\n    } // 18. If mode is non-null, set request’s mode to mode.\n\n\n    if (mode != null) {\n      request.mode = mode;\n    } // 19. If init[\"credentials\"] exists, then set request’s credentials mode\n    // to it.\n\n\n    if (init.credentials !== undefined) {\n      request.credentials = init.credentials;\n\n      if (!requestCredentials.includes(request.credentials)) {\n        throw new TypeError(`Failed to construct 'Request': The provided value '${request.credentials}' is not a valid enum value of type RequestCredentials.`);\n      }\n    } // 18. If init[\"cache\"] exists, then set request’s cache mode to it.\n\n\n    if (init.cache !== undefined) {\n      request.cache = init.cache;\n\n      if (!requestCache.includes(request.cache)) {\n        throw new TypeError(`Failed to construct 'Request': The provided value '${request.cache}' is not a valid enum value of type RequestCache.`);\n      }\n    } // 21. If request’s cache mode is \"only-if-cached\" and request’s mode is\n    // not \"same-origin\", then throw a TypeError.\n\n\n    if (request.cache === 'only-if-cached' && request.mode !== 'same-origin') {\n      throw new TypeError(\"'only-if-cached' can be set only with 'same-origin' mode\");\n    } // 22. If init[\"redirect\"] exists, then set request’s redirect mode to it.\n\n\n    if (init.redirect !== undefined) {\n      request.redirect = init.redirect;\n\n      if (!requestRedirect.includes(request.redirect)) {\n        throw new TypeError(`Failed to construct 'Request': The provided value '${request.redirect}' is not a valid enum value of type RequestRedirect.`);\n      }\n    } // 23. If init[\"integrity\"] exists, then set request’s integrity metadata to it.\n\n\n    if (init.integrity !== undefined && init.integrity != null) {\n      request.integrity = String(init.integrity);\n    } // 24. If init[\"keepalive\"] exists, then set request’s keepalive to it.\n\n\n    if (init.keepalive !== undefined) {\n      request.keepalive = Boolean(init.keepalive);\n    } // 25. If init[\"method\"] exists, then:\n\n\n    if (init.method !== undefined) {\n      // 1. Let method be init[\"method\"].\n      let method = init.method; // 2. If method is not a method or method is a forbidden method, then\n      // throw a TypeError.\n\n      if (!isValidHTTPToken(init.method)) {\n        throw TypeError(`'${init.method}' is not a valid HTTP method.`);\n      }\n\n      if (forbiddenMethods.indexOf(method.toUpperCase()) !== -1) {\n        throw TypeError(`'${init.method}' HTTP method is unsupported.`);\n      } // 3. Normalize method.\n      // https://fetch.spec.whatwg.org/#concept-method-normalize\n\n\n      method = init.method.toUpperCase(); // 4. Set request’s method to method.\n\n      request.method = method;\n    } // 26. If init[\"signal\"] exists, then set signal to it.\n\n\n    if (init.signal !== undefined) {\n      signal = init.signal;\n    } // 27. Set this’s request to request.\n\n\n    this[kState] = request; // 28. Set this’s signal to a new AbortSignal object with this’s relevant\n    // Realm.\n\n    const ac = new AbortController();\n    this[kSignal] = ac.signal;\n    this[kSignal][kRealm] = this[kRealm]; // 29. If signal is not null, then make this’s signal follow signal.\n\n    if (signal != null) {\n      if (!signal || typeof signal.aborted !== 'boolean' || typeof signal.addEventListener !== 'function') {\n        throw new TypeError(\"Failed to construct 'Request': member signal is not of type AbortSignal.\");\n      }\n\n      if (signal.aborted) {\n        ac.abort();\n      } else {\n        const abort = () => ac.abort();\n\n        signal.addEventListener('abort', abort, {\n          once: true\n        });\n        requestFinalizer.register(this, {\n          signal,\n          abort\n        });\n      }\n    } // 30. Set this’s headers to a new Headers object with this’s relevant\n    // Realm, whose header list is request’s header list and guard is\n    // \"request\".\n\n\n    this[kHeaders] = new Headers();\n    this[kHeaders][kGuard] = 'request';\n    this[kHeaders][kHeadersList] = request.headersList;\n    this[kHeaders][kRealm] = this[kRealm]; // 31. If this’s request’s mode is \"no-cors\", then:\n\n    if (mode === 'no-cors') {\n      // 1. If this’s request’s method is not a CORS-safelisted method,\n      // then throw a TypeError.\n      if (!corsSafeListedMethods.includes(request.method)) {\n        throw new TypeError(`'${request.method} is unsupported in no-cors mode.`);\n      } // 2. Set this’s headers’s guard to \"request-no-cors\".\n\n\n      this[kHeaders][kGuard] = 'request-no-cors';\n    } // 32. If init is not empty, then:\n\n\n    if (Object.keys(init).length !== 0) {\n      // 1. Let headers be a copy of this’s headers and its associated header\n      // list.\n      let headers = new Headers(this.headers); // 2. If init[\"headers\"] exists, then set headers to init[\"headers\"].\n\n      if (init.headers !== undefined) {\n        headers = init.headers;\n      } // 3. Empty this’s headers’s header list.\n\n\n      this[kState].headersList = new HeadersList();\n      this[kHeaders][kHeadersList] = this[kState].headersList; // 4. If headers is a Headers object, then for each header in its header\n      // list, append header’s name/header’s value to this’s headers.\n\n      if (headers instanceof Headers) {\n        this[kState].headersList.push(...headers[kHeadersList]);\n      } else {\n        // 5. Otherwise, fill this’s headers with headers.\n        fillHeaders(this[kState].headersList, headers);\n      }\n    } // 33. Let inputBody be input’s request’s body if input is a Request\n    // object; otherwise null.\n\n\n    const inputBody = input instanceof Request ? input[kState].body : null; // 34. If either init[\"body\"] exists and is non-null or inputBody is\n    // non-null, and request’s method is `GET` or `HEAD`, then throw a\n    // TypeError.\n\n    if ((init.body !== undefined && init.body != null || inputBody != null) && (request.method === 'GET' || request.method === 'HEAD')) {\n      throw new TypeError('Request with GET/HEAD method cannot have body.');\n    } // 35. Let initBody be null.\n\n\n    let initBody = null; // 36. If init[\"body\"] exists and is non-null, then:\n\n    if (init.body !== undefined && init.body != null) {\n      // 1. Let Content-Type be null.\n      // 2. Set initBody and Content-Type to the result of extracting\n      // init[\"body\"], with keepalive set to request’s keepalive.\n      const [extractedBody, contentType] = extractBody(init.body, request.keepalive);\n      initBody = extractedBody; // 3, If Content-Type is non-null and this’s headers’s header list does\n      // not contain `Content-Type`, then append `Content-Type`/Content-Type to\n      // this’s headers.\n\n      if (contentType && !this[kHeaders].has('content-type')) {\n        this[kHeaders].append('content-type', contentType);\n      }\n    } // 37. Let inputOrInitBody be initBody if it is non-null; otherwise\n    // inputBody.\n\n\n    const inputOrInitBody = initBody ?? inputBody; // 38. If inputOrInitBody is non-null and inputOrInitBody’s source is\n    // null, then:\n\n    if (inputOrInitBody != null && inputOrInitBody.source == null) {\n      // 1. If this’s request’s mode is neither \"same-origin\" nor \"cors\",\n      // then throw a TypeError.\n      if (request.mode !== 'same-origin' && request.mode !== 'cors') {\n        throw new TypeError('If request is made from ReadableStream, mode should be \"same-origin\" or \"cors\"');\n      } // 2. Set this’s request’s use-CORS-preflight flag.\n\n\n      request.useCORSPreflightFlag = true;\n    } // 39. Let finalBody be inputOrInitBody.\n\n\n    let finalBody = inputOrInitBody; // 40. If initBody is null and inputBody is non-null, then:\n\n    if (initBody == null && inputBody != null) {\n      // 1. If input is unusable, then throw a TypeError.\n      if (util.isDisturbed(inputBody.stream) || inputBody.stream.locked) {\n        throw new TypeError('Cannot construct a Request with a Request object that has already been used.');\n      } // 2. Set finalBody to the result of creating a proxy for inputBody.\n\n\n      if (!TransformStream) {\n        TransformStream = require('stream/web').TransformStream;\n      } // https://streams.spec.whatwg.org/#readablestream-create-a-proxy\n\n\n      const identityTransform = new TransformStream();\n      inputBody.stream.pipeThrough(identityTransform);\n      finalBody = {\n        source: inputBody.source,\n        length: inputBody.length,\n        stream: identityTransform.readable\n      };\n    } // 41. Set this’s request’s body to finalBody.\n\n\n    this[kState].body = finalBody;\n  }\n\n  get [Symbol.toStringTag]() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    }\n\n    return this.constructor.name;\n  } // Returns request’s HTTP method, which is \"GET\" by default.\n\n\n  get method() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // The method getter steps are to return this’s request’s method.\n\n\n    return this[kState].method;\n  } // Returns the URL of request as a string.\n\n\n  get url() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // The url getter steps are to return this’s request’s URL, serialized.\n\n\n    return this[kState].url.toString();\n  } // Returns a Headers object consisting of the headers associated with request.\n  // Note that headers added in the network layer by the user agent will not\n  // be accounted for in this object, e.g., the \"Host\" header.\n\n\n  get headers() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // The headers getter steps are to return this’s headers.\n\n\n    return this[kHeaders];\n  } // Returns the kind of resource requested by request, e.g., \"document\"\n  // or \"script\".\n\n\n  get destination() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // The destination getter are to return this’s request’s destination.\n\n\n    return this[kState].destination;\n  } // Returns the referrer of request. Its value can be a same-origin URL if\n  // explicitly set in init, the empty string to indicate no referrer, and\n  // \"about:client\" when defaulting to the global’s default. This is used\n  // during fetching to determine the value of the `Referer` header of the\n  // request being made.\n\n\n  get referrer() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // 1. If this’s request’s referrer is \"no-referrer\", then return the\n    // empty string.\n\n\n    if (this[kState].referrer === 'no-referrer') {\n      return '';\n    } // 2. If this’s request’s referrer is \"client\", then return\n    // \"about:client\".\n\n\n    if (this[kState].referrer === 'client') {\n      return 'about:client';\n    } // Return this’s request’s referrer, serialized.\n\n\n    return this[kState].referrer.toString();\n  } // Returns the referrer policy associated with request.\n  // This is used during fetching to compute the value of the request’s\n  // referrer.\n\n\n  get referrerPolicy() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // The referrerPolicy getter steps are to return this’s request’s referrer policy.\n\n\n    return this[kState].referrerPolicy;\n  } // Returns the mode associated with request, which is a string indicating\n  // whether the request will use CORS, or will be restricted to same-origin\n  // URLs.\n\n\n  get mode() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // The mode getter steps are to return this’s request’s mode.\n\n\n    return this[kState].mode;\n  } // Returns the credentials mode associated with request,\n  // which is a string indicating whether credentials will be sent with the\n  // request always, never, or only when sent to a same-origin URL.\n\n\n  get credentials() {\n    // The credentials getter steps are to return this’s request’s credentials mode.\n    return this[kState].credentials;\n  } // Returns the cache mode associated with request,\n  // which is a string indicating how the request will\n  // interact with the browser’s cache when fetching.\n\n\n  get cache() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // The cache getter steps are to return this’s request’s cache mode.\n\n\n    return this[kState].cache;\n  } // Returns the redirect mode associated with request,\n  // which is a string indicating how redirects for the\n  // request will be handled during fetching. A request\n  // will follow redirects by default.\n\n\n  get redirect() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // The redirect getter steps are to return this’s request’s redirect mode.\n\n\n    return this[kState].redirect;\n  } // Returns request’s subresource integrity metadata, which is a\n  // cryptographic hash of the resource being fetched. Its value\n  // consists of multiple hashes separated by whitespace. [SRI]\n\n\n  get integrity() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // The integrity getter steps are to return this’s request’s integrity\n    // metadata.\n\n\n    return this[kState].integrity;\n  } // Returns a boolean indicating whether or not request can outlive the\n  // global in which it was created.\n\n\n  get keepalive() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // The keepalive getter steps are to return this’s request’s keepalive.\n\n\n    return this[kState].keepalive;\n  } // Returns a boolean indicating whether or not request is for a reload\n  // navigation.\n\n\n  get isReloadNavigation() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // The isReloadNavigation getter steps are to return true if this’s\n    // request’s reload-navigation flag is set; otherwise false.\n\n\n    return this[kState].reloadNavigation;\n  } // Returns a boolean indicating whether or not request is for a history\n  // navigation (a.k.a. back-foward navigation).\n\n\n  get isHistoryNavigation() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // The isHistoryNavigation getter steps are to return true if this’s request’s\n    // history-navigation flag is set; otherwise false.\n\n\n    return this[kState].historyNavigation;\n  } // Returns the signal associated with request, which is an AbortSignal\n  // object indicating whether or not request has been aborted, and its\n  // abort event handler.\n\n\n  get signal() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // The signal getter steps are to return this’s signal.\n\n\n    return this[kSignal];\n  } // Returns a clone of request.\n\n\n  clone() {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation');\n    } // 1. If this is unusable, then throw a TypeError.\n\n\n    if (this.bodyUsed || this.body && this.body.locked) {\n      throw new TypeError('unusable');\n    } // 2. Let clonedRequest be the result of cloning this’s request.\n\n\n    const clonedRequest = cloneRequest(this[kState]); // 3. Let clonedRequestObject be the result of creating a Request object,\n    // given clonedRequest, this’s headers’s guard, and this’s relevant Realm.\n\n    const clonedRequestObject = new Request(kInit);\n    clonedRequestObject[kState] = clonedRequest;\n    clonedRequestObject[kRealm] = this[kRealm];\n    clonedRequestObject[kHeaders] = new Headers();\n    clonedRequestObject[kHeaders][kHeadersList] = clonedRequest.headersList;\n    clonedRequestObject[kHeaders][kGuard] = this[kHeaders][kGuard];\n    clonedRequestObject[kHeaders][kRealm] = this[kHeaders][kRealm]; // 4. Make clonedRequestObject’s signal follow this’s signal.\n\n    const ac = new AbortController();\n\n    if (this.signal.aborted) {\n      ac.abort();\n    } else {\n      this.signal.addEventListener('abort', function () {\n        ac.abort();\n      }, {\n        once: true\n      });\n    }\n\n    clonedRequestObject[kSignal] = ac.signal; // 4. Return clonedRequestObject.\n\n    return clonedRequestObject;\n  }\n\n}\n\nmixinBody(Request.prototype);\n\nfunction makeRequest(init) {\n  // https://fetch.spec.whatwg.org/#requests\n  const request = {\n    method: 'GET',\n    localURLsOnly: false,\n    unsafeRequest: false,\n    body: null,\n    client: null,\n    reservedClient: null,\n    replacesClientId: '',\n    window: 'client',\n    keepalive: false,\n    serviceWorkers: 'all',\n    initiator: '',\n    destination: '',\n    priority: null,\n    origin: 'client',\n    policyContainer: 'client',\n    referrer: 'client',\n    referrerPolicy: '',\n    mode: 'no-cors',\n    useCORSPreflightFlag: false,\n    credentials: 'same-origin',\n    useCredentials: false,\n    cache: 'default',\n    redirect: 'follow',\n    integrity: '',\n    cryptoGraphicsNonceMetadata: '',\n    parserMetadata: '',\n    reloadNavigation: false,\n    historyNavigation: false,\n    userActivation: false,\n    taintedOrigin: false,\n    redirectCount: 0,\n    responseTainting: 'basic',\n    preventNoCacheCacheControlHeaderModification: false,\n    done: false,\n    timingAllowFailed: false,\n    ...init,\n    headersList: init.headersList ? new HeadersList(...init.headersList) : new HeadersList(),\n    urlList: init.urlList ? [...init.urlList.map(url => new URL(url))] : []\n  };\n  request.url = request.urlList[0];\n  return request;\n} // https://fetch.spec.whatwg.org/#concept-request-clone\n\n\nfunction cloneRequest(request) {\n  // To clone a request request, run these steps:\n  // 1. Let newRequest be a copy of request, except for its body.\n  const newRequest = makeRequest({ ...request,\n    body: null\n  }); // 2. If request’s body is non-null, set newRequest’s body to the\n  // result of cloning request’s body.\n\n  if (request.body != null) {\n    newRequest.body = cloneBody(request.body);\n  } // 3. Return newRequest.\n\n\n  return newRequest;\n}\n\nObject.defineProperties(Request.prototype, {\n  method: kEnumerableProperty,\n  url: kEnumerableProperty,\n  headers: kEnumerableProperty,\n  redirect: kEnumerableProperty,\n  clone: kEnumerableProperty,\n  signal: kEnumerableProperty\n});\nmodule.exports = {\n  Request,\n  makeRequest\n};","map":{"version":3,"names":["extractBody","mixinBody","cloneBody","require","Headers","fill","fillHeaders","HeadersList","util","isValidHTTPToken","EnvironmentSettingsObject","sameOrigin","toUSVString","forbiddenMethods","corsSafeListedMethods","referrerPolicy","requestRedirect","requestMode","requestCredentials","requestCache","kEnumerableProperty","kHeaders","kSignal","kState","kGuard","kRealm","kHeadersList","assert","TransformStream","kInit","Symbol","requestFinalizer","FinalizationRegistry","signal","abort","removeEventListener","Request","constructor","length","TypeError","undefined","input","init","settingsObject","request","fallbackMode","baseUrl","parsedURL","URL","err","error","cause","username","password","makeRequest","urlList","origin","window","method","headersList","unsafeRequest","client","priority","referrer","mode","credentials","cache","redirect","integrity","keepalive","reloadNavigation","historyNavigation","Object","keys","url","parsedReferrer","includes","String","Boolean","indexOf","toUpperCase","ac","AbortController","aborted","addEventListener","once","register","headers","push","inputBody","body","initBody","extractedBody","contentType","has","append","inputOrInitBody","source","useCORSPreflightFlag","finalBody","isDisturbed","stream","locked","identityTransform","pipeThrough","readable","toStringTag","name","toString","destination","isReloadNavigation","isHistoryNavigation","clone","bodyUsed","clonedRequest","cloneRequest","clonedRequestObject","prototype","localURLsOnly","reservedClient","replacesClientId","serviceWorkers","initiator","policyContainer","useCredentials","cryptoGraphicsNonceMetadata","parserMetadata","userActivation","taintedOrigin","redirectCount","responseTainting","preventNoCacheCacheControlHeaderModification","done","timingAllowFailed","map","newRequest","defineProperties","module","exports"],"sources":["/Users/ja/Desktop/MyProjects/NalaSwap/webapp/nalaswap/node_modules/undici/lib/fetch/request.js"],"sourcesContent":["/* globals AbortController */\n\n'use strict'\n\nconst { extractBody, mixinBody, cloneBody } = require('./body')\nconst { Headers, fill: fillHeaders, HeadersList } = require('./headers')\nconst util = require('../core/util')\nconst {\n  isValidHTTPToken,\n  EnvironmentSettingsObject,\n  sameOrigin,\n  toUSVString\n} = require('./util')\nconst {\n  forbiddenMethods,\n  corsSafeListedMethods,\n  referrerPolicy,\n  requestRedirect,\n  requestMode,\n  requestCredentials,\n  requestCache\n} = require('./constants')\nconst { kEnumerableProperty } = util\nconst { kHeaders, kSignal, kState, kGuard, kRealm } = require('./symbols')\nconst { kHeadersList } = require('../core/symbols')\nconst assert = require('assert')\n\nlet TransformStream\n\nconst kInit = Symbol('init')\n\nconst requestFinalizer = new FinalizationRegistry(({ signal, abort }) => {\n  signal.removeEventListener('abort', abort)\n})\n\n// https://fetch.spec.whatwg.org/#request-class\nclass Request {\n  // https://fetch.spec.whatwg.org/#dom-request\n  constructor (...args) {\n    if (args[0] === kInit) {\n      return\n    }\n\n    if (args.length < 1) {\n      throw new TypeError(\n        `Failed to construct 'Request': 1 argument required, but only ${args.length} present.`\n      )\n    }\n    if (\n      args.length >= 1 &&\n      typeof args[1] !== 'object' &&\n      args[1] !== undefined\n    ) {\n      throw new TypeError(\n        \"Failed to construct 'Request': cannot convert to dictionary.\"\n      )\n    }\n    const input = args[0] instanceof Request ? args[0] : toUSVString(args[0])\n    const init = args.length >= 1 ? args[1] ?? {} : {}\n\n    // TODO\n    this[kRealm] = { settingsObject: {} }\n\n    // 1. Let request be null.\n    let request = null\n\n    // 2. Let fallbackMode be null.\n    let fallbackMode = null\n\n    // 3. Let baseURL be this’s relevant settings object’s API base URL.\n    const baseUrl = this[kRealm].settingsObject.baseUrl\n\n    // 4. Let signal be null.\n    let signal = null\n\n    // 5. If input is a string, then:\n    if (typeof input === 'string') {\n      // 1. Let parsedURL be the result of parsing input with baseURL.\n      // 2. If parsedURL is failure, then throw a TypeError.\n      let parsedURL\n      try {\n        parsedURL = new URL(input, baseUrl)\n      } catch (err) {\n        const error = new TypeError('Failed to parse URL from ' + input)\n        error.cause = err\n        throw error\n      }\n\n      // 3. If parsedURL includes credentials, then throw a TypeError.\n      if (parsedURL.username || parsedURL.password) {\n        throw new TypeError(\n          'Request cannot be constructed from a URL that includes credentials: ' +\n            input\n        )\n      }\n\n      // 4. Set request to a new request whose URL is parsedURL.\n      request = makeRequest({ urlList: [parsedURL] })\n\n      // 5. Set fallbackMode to \"cors\".\n      fallbackMode = 'cors'\n    } else {\n      // 6. Otherwise:\n\n      // 7. Assert: input is a Request object.\n      assert(input instanceof Request)\n\n      // 8. Set request to input’s request.\n      request = input[kState]\n\n      // 9. Set signal to input’s signal.\n      signal = input[kSignal]\n    }\n\n    // 7. Let origin be this’s relevant settings object’s origin.\n    const origin = this[kRealm].settingsObject.origin\n\n    // 8. Let window be \"client\".\n    let window = 'client'\n\n    // 9. If request’s window is an environment settings object and its origin\n    // is same origin with origin, then set window to request’s window.\n    if (\n      request.window instanceof EnvironmentSettingsObject &&\n      sameOrigin(request.window, origin)\n    ) {\n      window = request.window\n    }\n\n    // 10. If init[\"window\"] exists and is non-null, then throw a TypeError.\n    if (init.window !== undefined && init.window != null) {\n      throw new TypeError(`'window' option '${window}' must be null`)\n    }\n\n    // 11. If init[\"window\"] exists, then set window to \"no-window\".\n    if (init.window !== undefined) {\n      window = 'no-window'\n    }\n\n    // 12. Set request to a new request with the following properties:\n    request = makeRequest({\n      // URL request’s URL.\n      // undici implementation note: this is set as the first item in request's urlList in makeRequest\n      // method request’s method.\n      method: request.method,\n      // header list A copy of request’s header list.\n      // undici implementation note: headersList is cloned in makeRequest\n      headersList: request.headersList,\n      // unsafe-request flag Set.\n      unsafeRequest: request.unsafeRequest,\n      // client This’s relevant settings object.\n      client: request.client,\n      // window window.\n      window,\n      // priority request’s priority.\n      priority: request.priority,\n      // origin request’s origin. The propagation of the origin is only significant for navigation requests\n      // being handled by a service worker. In this scenario a request can have an origin that is different\n      // from the current client.\n      origin: request.origin,\n      // referrer request’s referrer.\n      referrer: request.referrer,\n      // referrer policy request’s referrer policy.\n      referrerPolicy: request.referrerPolicy,\n      // mode request’s mode.\n      mode: request.mode,\n      // credentials mode request’s credentials mode.\n      credentials: request.credentials,\n      // cache mode request’s cache mode.\n      cache: request.cache,\n      // redirect mode request’s redirect mode.\n      redirect: request.redirect,\n      // integrity metadata request’s integrity metadata.\n      integrity: request.integrity,\n      // keepalive request’s keepalive.\n      keepalive: request.keepalive,\n      // reload-navigation flag request’s reload-navigation flag.\n      reloadNavigation: request.reloadNavigation,\n      // history-navigation flag request’s history-navigation flag.\n      historyNavigation: request.historyNavigation,\n      // URL list A clone of request’s URL list.\n      // undici implementation note: urlList is cloned in makeRequest\n      urlList: request.urlList\n    })\n\n    // 13. If init is not empty, then:\n    if (Object.keys(init).length > 0) {\n      // 1. If request’s mode is \"navigate\", then set it to \"same-origin\".\n      if (request.mode === 'navigate') {\n        request.mode = 'same-origin'\n      }\n\n      // 2. Unset request’s reload-navigation flag.\n      request.reloadNavigation = false\n\n      // 3. Unset request’s history-navigation flag.\n      request.historyNavigation = false\n\n      // 4. Set request’s origin to \"client\".\n      request.origin = 'client'\n\n      // 5. Set request’s referrer to \"client\"\n      request.referrer = 'client'\n\n      // 6. Set request’s referrer policy to the empty string.\n      request.referrerPolicy = ''\n\n      // 7. Set request’s URL to request’s current URL.\n      request.url = request.urlList[request.urlList.length - 1]\n\n      // 8. Set request’s URL list to « request’s URL ».\n      request.urlList = [request.url]\n    }\n\n    // 14. If init[\"referrer\"] exists, then:\n    if (init.referrer !== undefined) {\n      // 1. Let referrer be init[\"referrer\"].\n      const referrer = init.referrer\n\n      // 2. If referrer is the empty string, then set request’s referrer to \"no-referrer\".\n      if (referrer === '') {\n        request.referrer = 'no-referrer'\n      } else {\n        // 1. Let parsedReferrer be the result of parsing referrer with\n        // baseURL.\n        // 2. If parsedReferrer is failure, then throw a TypeError.\n        let parsedReferrer\n        try {\n          parsedReferrer = new URL(referrer, baseUrl)\n        } catch (err) {\n          const error = new TypeError(\n            `Referrer \"${referrer}\" is not a valid URL.`\n          )\n          error.cause = err\n          throw error\n        }\n\n        // 3. If one of the following is true\n        // parsedReferrer’s cannot-be-a-base-URL is true, scheme is \"about\",\n        // and path contains a single string \"client\"\n        // parsedReferrer’s origin is not same origin with origin\n        // then set request’s referrer to \"client\".\n        // TODO\n\n        // 4. Otherwise, set request’s referrer to parsedReferrer.\n        request.referrer = parsedReferrer\n      }\n    }\n\n    // 15. If init[\"referrerPolicy\"] exists, then set request’s referrer policy\n    // to it.\n    if (init.referrerPolicy !== undefined) {\n      request.referrerPolicy = init.referrerPolicy\n      if (!referrerPolicy.includes(request.referrerPolicy)) {\n        throw new TypeError(\n          `Failed to construct 'Request': The provided value '${request.referrerPolicy}' is not a valid enum value of type ReferrerPolicy.`\n        )\n      }\n    }\n\n    // 16. Let mode be init[\"mode\"] if it exists, and fallbackMode otherwise.\n    let mode\n    if (init.mode !== undefined) {\n      mode = init.mode\n      if (!requestMode.includes(mode)) {\n        throw new TypeError(\n          `Failed to construct 'Request': The provided value '${request.mode}' is not a valid enum value of type RequestMode.`\n        )\n      }\n    } else {\n      mode = fallbackMode\n    }\n\n    // 17. If mode is \"navigate\", then throw a TypeError.\n    if (mode === 'navigate') {\n      throw new TypeError()\n    }\n\n    // 18. If mode is non-null, set request’s mode to mode.\n    if (mode != null) {\n      request.mode = mode\n    }\n\n    // 19. If init[\"credentials\"] exists, then set request’s credentials mode\n    // to it.\n    if (init.credentials !== undefined) {\n      request.credentials = init.credentials\n      if (!requestCredentials.includes(request.credentials)) {\n        throw new TypeError(\n          `Failed to construct 'Request': The provided value '${request.credentials}' is not a valid enum value of type RequestCredentials.`\n        )\n      }\n    }\n\n    // 18. If init[\"cache\"] exists, then set request’s cache mode to it.\n    if (init.cache !== undefined) {\n      request.cache = init.cache\n      if (!requestCache.includes(request.cache)) {\n        throw new TypeError(\n          `Failed to construct 'Request': The provided value '${request.cache}' is not a valid enum value of type RequestCache.`\n        )\n      }\n    }\n\n    // 21. If request’s cache mode is \"only-if-cached\" and request’s mode is\n    // not \"same-origin\", then throw a TypeError.\n    if (request.cache === 'only-if-cached' && request.mode !== 'same-origin') {\n      throw new TypeError(\n        \"'only-if-cached' can be set only with 'same-origin' mode\"\n      )\n    }\n\n    // 22. If init[\"redirect\"] exists, then set request’s redirect mode to it.\n    if (init.redirect !== undefined) {\n      request.redirect = init.redirect\n      if (!requestRedirect.includes(request.redirect)) {\n        throw new TypeError(\n          `Failed to construct 'Request': The provided value '${request.redirect}' is not a valid enum value of type RequestRedirect.`\n        )\n      }\n    }\n\n    // 23. If init[\"integrity\"] exists, then set request’s integrity metadata to it.\n    if (init.integrity !== undefined && init.integrity != null) {\n      request.integrity = String(init.integrity)\n    }\n\n    // 24. If init[\"keepalive\"] exists, then set request’s keepalive to it.\n    if (init.keepalive !== undefined) {\n      request.keepalive = Boolean(init.keepalive)\n    }\n\n    // 25. If init[\"method\"] exists, then:\n    if (init.method !== undefined) {\n      // 1. Let method be init[\"method\"].\n      let method = init.method\n\n      // 2. If method is not a method or method is a forbidden method, then\n      // throw a TypeError.\n      if (!isValidHTTPToken(init.method)) {\n        throw TypeError(`'${init.method}' is not a valid HTTP method.`)\n      }\n\n      if (forbiddenMethods.indexOf(method.toUpperCase()) !== -1) {\n        throw TypeError(`'${init.method}' HTTP method is unsupported.`)\n      }\n\n      // 3. Normalize method.\n      // https://fetch.spec.whatwg.org/#concept-method-normalize\n      method = init.method.toUpperCase()\n\n      // 4. Set request’s method to method.\n      request.method = method\n    }\n\n    // 26. If init[\"signal\"] exists, then set signal to it.\n    if (init.signal !== undefined) {\n      signal = init.signal\n    }\n\n    // 27. Set this’s request to request.\n    this[kState] = request\n\n    // 28. Set this’s signal to a new AbortSignal object with this’s relevant\n    // Realm.\n    const ac = new AbortController()\n    this[kSignal] = ac.signal\n    this[kSignal][kRealm] = this[kRealm]\n\n    // 29. If signal is not null, then make this’s signal follow signal.\n    if (signal != null) {\n      if (\n        !signal ||\n        typeof signal.aborted !== 'boolean' ||\n        typeof signal.addEventListener !== 'function'\n      ) {\n        throw new TypeError(\n          \"Failed to construct 'Request': member signal is not of type AbortSignal.\"\n        )\n      }\n\n      if (signal.aborted) {\n        ac.abort()\n      } else {\n        const abort = () => ac.abort()\n        signal.addEventListener('abort', abort, { once: true })\n        requestFinalizer.register(this, { signal, abort })\n      }\n    }\n\n    // 30. Set this’s headers to a new Headers object with this’s relevant\n    // Realm, whose header list is request’s header list and guard is\n    // \"request\".\n    this[kHeaders] = new Headers()\n    this[kHeaders][kGuard] = 'request'\n    this[kHeaders][kHeadersList] = request.headersList\n    this[kHeaders][kRealm] = this[kRealm]\n\n    // 31. If this’s request’s mode is \"no-cors\", then:\n    if (mode === 'no-cors') {\n      // 1. If this’s request’s method is not a CORS-safelisted method,\n      // then throw a TypeError.\n      if (!corsSafeListedMethods.includes(request.method)) {\n        throw new TypeError(\n          `'${request.method} is unsupported in no-cors mode.`\n        )\n      }\n\n      // 2. Set this’s headers’s guard to \"request-no-cors\".\n      this[kHeaders][kGuard] = 'request-no-cors'\n    }\n\n    // 32. If init is not empty, then:\n    if (Object.keys(init).length !== 0) {\n      // 1. Let headers be a copy of this’s headers and its associated header\n      // list.\n      let headers = new Headers(this.headers)\n\n      // 2. If init[\"headers\"] exists, then set headers to init[\"headers\"].\n      if (init.headers !== undefined) {\n        headers = init.headers\n      }\n\n      // 3. Empty this’s headers’s header list.\n      this[kState].headersList = new HeadersList()\n      this[kHeaders][kHeadersList] = this[kState].headersList\n\n      // 4. If headers is a Headers object, then for each header in its header\n      // list, append header’s name/header’s value to this’s headers.\n      if (headers instanceof Headers) {\n        this[kState].headersList.push(...headers[kHeadersList])\n      } else {\n        // 5. Otherwise, fill this’s headers with headers.\n        fillHeaders(this[kState].headersList, headers)\n      }\n    }\n\n    // 33. Let inputBody be input’s request’s body if input is a Request\n    // object; otherwise null.\n    const inputBody = input instanceof Request ? input[kState].body : null\n\n    // 34. If either init[\"body\"] exists and is non-null or inputBody is\n    // non-null, and request’s method is `GET` or `HEAD`, then throw a\n    // TypeError.\n    if (\n      ((init.body !== undefined && init.body != null) || inputBody != null) &&\n      (request.method === 'GET' || request.method === 'HEAD')\n    ) {\n      throw new TypeError('Request with GET/HEAD method cannot have body.')\n    }\n\n    // 35. Let initBody be null.\n    let initBody = null\n\n    // 36. If init[\"body\"] exists and is non-null, then:\n    if (init.body !== undefined && init.body != null) {\n      // 1. Let Content-Type be null.\n      // 2. Set initBody and Content-Type to the result of extracting\n      // init[\"body\"], with keepalive set to request’s keepalive.\n      const [extractedBody, contentType] = extractBody(\n        init.body,\n        request.keepalive\n      )\n      initBody = extractedBody\n\n      // 3, If Content-Type is non-null and this’s headers’s header list does\n      // not contain `Content-Type`, then append `Content-Type`/Content-Type to\n      // this’s headers.\n      if (contentType && !this[kHeaders].has('content-type')) {\n        this[kHeaders].append('content-type', contentType)\n      }\n    }\n\n    // 37. Let inputOrInitBody be initBody if it is non-null; otherwise\n    // inputBody.\n    const inputOrInitBody = initBody ?? inputBody\n\n    // 38. If inputOrInitBody is non-null and inputOrInitBody’s source is\n    // null, then:\n    if (inputOrInitBody != null && inputOrInitBody.source == null) {\n      // 1. If this’s request’s mode is neither \"same-origin\" nor \"cors\",\n      // then throw a TypeError.\n      if (request.mode !== 'same-origin' && request.mode !== 'cors') {\n        throw new TypeError(\n          'If request is made from ReadableStream, mode should be \"same-origin\" or \"cors\"'\n        )\n      }\n\n      // 2. Set this’s request’s use-CORS-preflight flag.\n      request.useCORSPreflightFlag = true\n    }\n\n    // 39. Let finalBody be inputOrInitBody.\n    let finalBody = inputOrInitBody\n\n    // 40. If initBody is null and inputBody is non-null, then:\n    if (initBody == null && inputBody != null) {\n      // 1. If input is unusable, then throw a TypeError.\n      if (util.isDisturbed(inputBody.stream) || inputBody.stream.locked) {\n        throw new TypeError(\n          'Cannot construct a Request with a Request object that has already been used.'\n        )\n      }\n\n      // 2. Set finalBody to the result of creating a proxy for inputBody.\n      if (!TransformStream) {\n        TransformStream = require('stream/web').TransformStream\n      }\n\n      // https://streams.spec.whatwg.org/#readablestream-create-a-proxy\n      const identityTransform = new TransformStream()\n      inputBody.stream.pipeThrough(identityTransform)\n      finalBody = {\n        source: inputBody.source,\n        length: inputBody.length,\n        stream: identityTransform.readable\n      }\n    }\n\n    // 41. Set this’s request’s body to finalBody.\n    this[kState].body = finalBody\n  }\n\n  get [Symbol.toStringTag] () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    return this.constructor.name\n  }\n\n  // Returns request’s HTTP method, which is \"GET\" by default.\n  get method () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // The method getter steps are to return this’s request’s method.\n    return this[kState].method\n  }\n\n  // Returns the URL of request as a string.\n  get url () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // The url getter steps are to return this’s request’s URL, serialized.\n    return this[kState].url.toString()\n  }\n\n  // Returns a Headers object consisting of the headers associated with request.\n  // Note that headers added in the network layer by the user agent will not\n  // be accounted for in this object, e.g., the \"Host\" header.\n  get headers () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // The headers getter steps are to return this’s headers.\n    return this[kHeaders]\n  }\n\n  // Returns the kind of resource requested by request, e.g., \"document\"\n  // or \"script\".\n  get destination () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // The destination getter are to return this’s request’s destination.\n    return this[kState].destination\n  }\n\n  // Returns the referrer of request. Its value can be a same-origin URL if\n  // explicitly set in init, the empty string to indicate no referrer, and\n  // \"about:client\" when defaulting to the global’s default. This is used\n  // during fetching to determine the value of the `Referer` header of the\n  // request being made.\n  get referrer () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // 1. If this’s request’s referrer is \"no-referrer\", then return the\n    // empty string.\n    if (this[kState].referrer === 'no-referrer') {\n      return ''\n    }\n\n    // 2. If this’s request’s referrer is \"client\", then return\n    // \"about:client\".\n    if (this[kState].referrer === 'client') {\n      return 'about:client'\n    }\n\n    // Return this’s request’s referrer, serialized.\n    return this[kState].referrer.toString()\n  }\n\n  // Returns the referrer policy associated with request.\n  // This is used during fetching to compute the value of the request’s\n  // referrer.\n  get referrerPolicy () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // The referrerPolicy getter steps are to return this’s request’s referrer policy.\n    return this[kState].referrerPolicy\n  }\n\n  // Returns the mode associated with request, which is a string indicating\n  // whether the request will use CORS, or will be restricted to same-origin\n  // URLs.\n  get mode () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // The mode getter steps are to return this’s request’s mode.\n    return this[kState].mode\n  }\n\n  // Returns the credentials mode associated with request,\n  // which is a string indicating whether credentials will be sent with the\n  // request always, never, or only when sent to a same-origin URL.\n  get credentials () {\n    // The credentials getter steps are to return this’s request’s credentials mode.\n    return this[kState].credentials\n  }\n\n  // Returns the cache mode associated with request,\n  // which is a string indicating how the request will\n  // interact with the browser’s cache when fetching.\n  get cache () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // The cache getter steps are to return this’s request’s cache mode.\n    return this[kState].cache\n  }\n\n  // Returns the redirect mode associated with request,\n  // which is a string indicating how redirects for the\n  // request will be handled during fetching. A request\n  // will follow redirects by default.\n  get redirect () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // The redirect getter steps are to return this’s request’s redirect mode.\n    return this[kState].redirect\n  }\n\n  // Returns request’s subresource integrity metadata, which is a\n  // cryptographic hash of the resource being fetched. Its value\n  // consists of multiple hashes separated by whitespace. [SRI]\n  get integrity () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // The integrity getter steps are to return this’s request’s integrity\n    // metadata.\n    return this[kState].integrity\n  }\n\n  // Returns a boolean indicating whether or not request can outlive the\n  // global in which it was created.\n  get keepalive () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // The keepalive getter steps are to return this’s request’s keepalive.\n    return this[kState].keepalive\n  }\n\n  // Returns a boolean indicating whether or not request is for a reload\n  // navigation.\n  get isReloadNavigation () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // The isReloadNavigation getter steps are to return true if this’s\n    // request’s reload-navigation flag is set; otherwise false.\n    return this[kState].reloadNavigation\n  }\n\n  // Returns a boolean indicating whether or not request is for a history\n  // navigation (a.k.a. back-foward navigation).\n  get isHistoryNavigation () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // The isHistoryNavigation getter steps are to return true if this’s request’s\n    // history-navigation flag is set; otherwise false.\n    return this[kState].historyNavigation\n  }\n\n  // Returns the signal associated with request, which is an AbortSignal\n  // object indicating whether or not request has been aborted, and its\n  // abort event handler.\n  get signal () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // The signal getter steps are to return this’s signal.\n    return this[kSignal]\n  }\n\n  // Returns a clone of request.\n  clone () {\n    if (!(this instanceof Request)) {\n      throw new TypeError('Illegal invocation')\n    }\n\n    // 1. If this is unusable, then throw a TypeError.\n    if (this.bodyUsed || (this.body && this.body.locked)) {\n      throw new TypeError('unusable')\n    }\n\n    // 2. Let clonedRequest be the result of cloning this’s request.\n    const clonedRequest = cloneRequest(this[kState])\n\n    // 3. Let clonedRequestObject be the result of creating a Request object,\n    // given clonedRequest, this’s headers’s guard, and this’s relevant Realm.\n    const clonedRequestObject = new Request(kInit)\n    clonedRequestObject[kState] = clonedRequest\n    clonedRequestObject[kRealm] = this[kRealm]\n    clonedRequestObject[kHeaders] = new Headers()\n    clonedRequestObject[kHeaders][kHeadersList] = clonedRequest.headersList\n    clonedRequestObject[kHeaders][kGuard] = this[kHeaders][kGuard]\n    clonedRequestObject[kHeaders][kRealm] = this[kHeaders][kRealm]\n\n    // 4. Make clonedRequestObject’s signal follow this’s signal.\n    const ac = new AbortController()\n    if (this.signal.aborted) {\n      ac.abort()\n    } else {\n      this.signal.addEventListener(\n        'abort',\n        function () {\n          ac.abort()\n        },\n        { once: true }\n      )\n    }\n    clonedRequestObject[kSignal] = ac.signal\n\n    // 4. Return clonedRequestObject.\n    return clonedRequestObject\n  }\n}\n\nmixinBody(Request.prototype)\n\nfunction makeRequest (init) {\n  // https://fetch.spec.whatwg.org/#requests\n  const request = {\n    method: 'GET',\n    localURLsOnly: false,\n    unsafeRequest: false,\n    body: null,\n    client: null,\n    reservedClient: null,\n    replacesClientId: '',\n    window: 'client',\n    keepalive: false,\n    serviceWorkers: 'all',\n    initiator: '',\n    destination: '',\n    priority: null,\n    origin: 'client',\n    policyContainer: 'client',\n    referrer: 'client',\n    referrerPolicy: '',\n    mode: 'no-cors',\n    useCORSPreflightFlag: false,\n    credentials: 'same-origin',\n    useCredentials: false,\n    cache: 'default',\n    redirect: 'follow',\n    integrity: '',\n    cryptoGraphicsNonceMetadata: '',\n    parserMetadata: '',\n    reloadNavigation: false,\n    historyNavigation: false,\n    userActivation: false,\n    taintedOrigin: false,\n    redirectCount: 0,\n    responseTainting: 'basic',\n    preventNoCacheCacheControlHeaderModification: false,\n    done: false,\n    timingAllowFailed: false,\n    ...init,\n    headersList: init.headersList\n      ? new HeadersList(...init.headersList)\n      : new HeadersList(),\n    urlList: init.urlList ? [...init.urlList.map((url) => new URL(url))] : []\n  }\n  request.url = request.urlList[0]\n  return request\n}\n\n// https://fetch.spec.whatwg.org/#concept-request-clone\nfunction cloneRequest (request) {\n  // To clone a request request, run these steps:\n\n  // 1. Let newRequest be a copy of request, except for its body.\n  const newRequest = makeRequest({ ...request, body: null })\n\n  // 2. If request’s body is non-null, set newRequest’s body to the\n  // result of cloning request’s body.\n  if (request.body != null) {\n    newRequest.body = cloneBody(request.body)\n  }\n\n  // 3. Return newRequest.\n  return newRequest\n}\n\nObject.defineProperties(Request.prototype, {\n  method: kEnumerableProperty,\n  url: kEnumerableProperty,\n  headers: kEnumerableProperty,\n  redirect: kEnumerableProperty,\n  clone: kEnumerableProperty,\n  signal: kEnumerableProperty\n})\n\nmodule.exports = { Request, makeRequest }\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}