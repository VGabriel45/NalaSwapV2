{"ast":null,"code":"'use strict';\n\nconst {\n  BalancedPoolMissingUpstreamError,\n  InvalidArgumentError\n} = require('./core/errors');\n\nconst {\n  PoolBase,\n  kClients,\n  kNeedDrain,\n  kAddClient,\n  kRemoveClient,\n  kGetDispatcher\n} = require('./pool-base');\n\nconst Pool = require('./pool');\n\nconst {\n  kUrl\n} = require('./core/symbols');\n\nconst {\n  parseOrigin\n} = require('./core/util');\n\nconst kFactory = Symbol('factory');\nconst kOptions = Symbol('options');\n\nfunction defaultFactory(origin, opts) {\n  return new Pool(origin, opts);\n}\n\nclass BalancedPool extends PoolBase {\n  constructor() {\n    let upstreams = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    let {\n      factory = defaultFactory,\n      ...opts\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super();\n    this[kOptions] = opts;\n\n    if (!Array.isArray(upstreams)) {\n      upstreams = [upstreams];\n    }\n\n    if (typeof factory !== 'function') {\n      throw new InvalidArgumentError('factory must be a function.');\n    }\n\n    this[kFactory] = factory;\n\n    for (const upstream of upstreams) {\n      this.addUpstream(upstream);\n    }\n  }\n\n  addUpstream(upstream) {\n    const upstreamOrigin = parseOrigin(upstream).origin;\n\n    if (this[kClients].find(pool => pool[kUrl].origin === upstreamOrigin && pool.closed !== true && pool.destroyed !== true)) {\n      return this;\n    }\n\n    this[kAddClient](this[kFactory](upstreamOrigin, Object.assign({}, this[kOptions])));\n    return this;\n  }\n\n  removeUpstream(upstream) {\n    const upstreamOrigin = parseOrigin(upstream).origin;\n    const pool = this[kClients].find(pool => pool[kUrl].origin === upstreamOrigin && pool.closed !== true && pool.destroyed !== true);\n\n    if (pool) {\n      this[kRemoveClient](pool);\n    }\n\n    return this;\n  }\n\n  get upstreams() {\n    return this[kClients].filter(dispatcher => dispatcher.closed !== true && dispatcher.destroyed !== true).map(p => p[kUrl].origin);\n  }\n\n  [kGetDispatcher]() {\n    // We validate that pools is greater than 0,\n    // otherwise we would have to wait until an upstream\n    // is added, which might never happen.\n    if (this[kClients].length === 0) {\n      throw new BalancedPoolMissingUpstreamError();\n    }\n\n    const dispatcher = this[kClients].find(dispatcher => !dispatcher[kNeedDrain] && dispatcher.closed !== true && dispatcher.destroyed !== true);\n\n    if (!dispatcher) {\n      return;\n    }\n\n    this[kClients].splice(this[kClients].indexOf(dispatcher), 1);\n    this[kClients].push(dispatcher);\n    return dispatcher;\n  }\n\n}\n\nmodule.exports = BalancedPool;","map":{"version":3,"names":["BalancedPoolMissingUpstreamError","InvalidArgumentError","require","PoolBase","kClients","kNeedDrain","kAddClient","kRemoveClient","kGetDispatcher","Pool","kUrl","parseOrigin","kFactory","Symbol","kOptions","defaultFactory","origin","opts","BalancedPool","constructor","upstreams","factory","Array","isArray","upstream","addUpstream","upstreamOrigin","find","pool","closed","destroyed","Object","assign","removeUpstream","filter","dispatcher","map","p","length","splice","indexOf","push","module","exports"],"sources":["/Users/ja/Desktop/MyProjects/NalaSwap/webapp/nalaswap/node_modules/undici/lib/balanced-pool.js"],"sourcesContent":["'use strict'\n\nconst {\n  BalancedPoolMissingUpstreamError,\n  InvalidArgumentError\n} = require('./core/errors')\nconst {\n  PoolBase,\n  kClients,\n  kNeedDrain,\n  kAddClient,\n  kRemoveClient,\n  kGetDispatcher\n} = require('./pool-base')\nconst Pool = require('./pool')\nconst { kUrl } = require('./core/symbols')\nconst { parseOrigin } = require('./core/util')\nconst kFactory = Symbol('factory')\n\nconst kOptions = Symbol('options')\n\nfunction defaultFactory (origin, opts) {\n  return new Pool(origin, opts)\n}\n\nclass BalancedPool extends PoolBase {\n  constructor (upstreams = [], { factory = defaultFactory, ...opts } = {}) {\n    super()\n\n    this[kOptions] = opts\n\n    if (!Array.isArray(upstreams)) {\n      upstreams = [upstreams]\n    }\n\n    if (typeof factory !== 'function') {\n      throw new InvalidArgumentError('factory must be a function.')\n    }\n\n    this[kFactory] = factory\n\n    for (const upstream of upstreams) {\n      this.addUpstream(upstream)\n    }\n  }\n\n  addUpstream (upstream) {\n    const upstreamOrigin = parseOrigin(upstream).origin\n\n    if (this[kClients].find((pool) => (\n      pool[kUrl].origin === upstreamOrigin &&\n      pool.closed !== true &&\n      pool.destroyed !== true\n    ))) {\n      return this\n    }\n\n    this[kAddClient](this[kFactory](upstreamOrigin, Object.assign({}, this[kOptions])))\n\n    return this\n  }\n\n  removeUpstream (upstream) {\n    const upstreamOrigin = parseOrigin(upstream).origin\n\n    const pool = this[kClients].find((pool) => (\n      pool[kUrl].origin === upstreamOrigin &&\n      pool.closed !== true &&\n      pool.destroyed !== true\n    ))\n\n    if (pool) {\n      this[kRemoveClient](pool)\n    }\n\n    return this\n  }\n\n  get upstreams () {\n    return this[kClients]\n      .filter(dispatcher => dispatcher.closed !== true && dispatcher.destroyed !== true)\n      .map((p) => p[kUrl].origin)\n  }\n\n  [kGetDispatcher] () {\n    // We validate that pools is greater than 0,\n    // otherwise we would have to wait until an upstream\n    // is added, which might never happen.\n    if (this[kClients].length === 0) {\n      throw new BalancedPoolMissingUpstreamError()\n    }\n\n    const dispatcher = this[kClients].find(dispatcher => (\n      !dispatcher[kNeedDrain] &&\n      dispatcher.closed !== true &&\n      dispatcher.destroyed !== true\n    ))\n\n    if (!dispatcher) {\n      return\n    }\n\n    this[kClients].splice(this[kClients].indexOf(dispatcher), 1)\n    this[kClients].push(dispatcher)\n\n    return dispatcher\n  }\n}\n\nmodule.exports = BalancedPool\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}