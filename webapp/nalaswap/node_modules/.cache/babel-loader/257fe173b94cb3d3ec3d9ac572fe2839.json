{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.writeTelemetryConsent = exports.hasConsentedTelemetry = exports.getCompilersDir = exports.writeAnalyticsId = exports.readSecondLegacyAnalyticsId = exports.readFirstLegacyAnalyticsId = exports.readAnalyticsId = exports.getCacheDir = void 0;\n\nconst debug_1 = __importDefault(require(\"debug\"));\n\nconst fs_extra_1 = __importDefault(require(\"fs-extra\"));\n\nconst os_1 = __importDefault(require(\"os\"));\n\nconst path_1 = __importDefault(require(\"path\"));\n\nconst log = (0, debug_1.default)(\"hardhat:core:global-dir\");\n\nasync function generatePaths() {\n  let packageName = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"hardhat\";\n  const {\n    default: envPaths\n  } = await Promise.resolve().then(() => __importStar(require(\"env-paths\")));\n  return envPaths(packageName);\n}\n\nfunction generatePathsSync() {\n  let packageName = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"hardhat\";\n\n  const envPaths = require(\"env-paths\");\n\n  return envPaths(packageName);\n}\n\nfunction getConfigDirSync() {\n  const {\n    config\n  } = generatePathsSync();\n  fs_extra_1.default.ensureDirSync(config);\n  return config;\n}\n\nasync function getDataDir(packageName) {\n  const {\n    data\n  } = await generatePaths(packageName);\n  await fs_extra_1.default.ensureDir(data);\n  return data;\n}\n\nasync function getCacheDir() {\n  const {\n    cache\n  } = await generatePaths();\n  await fs_extra_1.default.ensureDir(cache);\n  return cache;\n}\n\nexports.getCacheDir = getCacheDir;\n\nasync function readAnalyticsId() {\n  const globalDataDir = await getDataDir();\n  const idFile = path_1.default.join(globalDataDir, \"analytics.json\");\n  return readId(idFile);\n}\n\nexports.readAnalyticsId = readAnalyticsId;\n/**\n * This is the first way that the analytics id was saved.\n */\n\nfunction readFirstLegacyAnalyticsId() {\n  const oldIdFile = path_1.default.join(os_1.default.homedir(), \".buidler\", \"config.json\");\n  return readId(oldIdFile);\n}\n\nexports.readFirstLegacyAnalyticsId = readFirstLegacyAnalyticsId;\n/**\n * This is the same way the analytics id is saved now, but using buidler as the\n * name of the project for env-paths\n */\n\nasync function readSecondLegacyAnalyticsId() {\n  const globalDataDir = await getDataDir(\"buidler\");\n  const idFile = path_1.default.join(globalDataDir, \"analytics.json\");\n  return readId(idFile);\n}\n\nexports.readSecondLegacyAnalyticsId = readSecondLegacyAnalyticsId;\n\nasync function readId(idFile) {\n  log(`Looking up Client Id at ${idFile}`);\n  let clientId;\n\n  try {\n    const data = await fs_extra_1.default.readJSON(idFile, {\n      encoding: \"utf8\"\n    });\n    clientId = data.analytics.clientId;\n  } catch (error) {\n    return undefined;\n  }\n\n  log(`Client Id found: ${clientId}`);\n  return clientId;\n}\n\nasync function writeAnalyticsId(clientId) {\n  const globalDataDir = await getDataDir();\n  const idFile = path_1.default.join(globalDataDir, \"analytics.json\");\n  await fs_extra_1.default.writeJSON(idFile, {\n    analytics: {\n      clientId\n    }\n  }, {\n    encoding: \"utf-8\",\n    spaces: 2\n  });\n  log(`Stored clientId ${clientId}`);\n}\n\nexports.writeAnalyticsId = writeAnalyticsId;\n\nasync function getCompilersDir() {\n  const cache = await getCacheDir();\n  const compilersCache = path_1.default.join(cache, \"compilers\");\n  await fs_extra_1.default.ensureDir(compilersCache);\n  return compilersCache;\n}\n\nexports.getCompilersDir = getCompilersDir;\n/**\n * Checks if the user has given (or refused) consent for telemetry.\n *\n * Returns undefined if it can't be determined.\n */\n\nfunction hasConsentedTelemetry() {\n  const configDir = getConfigDirSync();\n  const telemetryConsentPath = path_1.default.join(configDir, \"telemetry-consent.json\");\n  const fileExists = fs_extra_1.default.pathExistsSync(telemetryConsentPath);\n\n  if (!fileExists) {\n    return undefined;\n  }\n\n  const {\n    consent\n  } = fs_extra_1.default.readJSONSync(telemetryConsentPath);\n  return consent;\n}\n\nexports.hasConsentedTelemetry = hasConsentedTelemetry;\n\nfunction writeTelemetryConsent(consent) {\n  const configDir = getConfigDirSync();\n  const telemetryConsentPath = path_1.default.join(configDir, \"telemetry-consent.json\");\n  fs_extra_1.default.writeJSONSync(telemetryConsentPath, {\n    consent\n  }, {\n    spaces: 2\n  });\n}\n\nexports.writeTelemetryConsent = writeTelemetryConsent;","map":{"version":3,"mappings":"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","names":["log","generatePaths","packageName","default","envPaths","generatePathsSync","require","getConfigDirSync","config","fs_extra_1","ensureDirSync","getDataDir","data","ensureDir","getCacheDir","cache","exports","readAnalyticsId","globalDataDir","idFile","path_1","join","readId","readFirstLegacyAnalyticsId","oldIdFile","os_1","homedir","readSecondLegacyAnalyticsId","clientId","readJSON","encoding","analytics","error","undefined","writeAnalyticsId","writeJSON","spaces","getCompilersDir","compilersCache","hasConsentedTelemetry","configDir","telemetryConsentPath","fileExists","pathExistsSync","consent","readJSONSync","writeTelemetryConsent","writeJSONSync"],"sourceRoot":"","sources":["../../src/internal/util/global-dir.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}